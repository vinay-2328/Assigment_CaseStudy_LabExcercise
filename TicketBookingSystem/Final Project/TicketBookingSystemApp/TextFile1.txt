using System;
using TicketBookingSystem.Entity;
using TicketBookingSystem.BusinessLayer.Repository;

namespace TicketBookingSystem
{
    public class TicketBookingSystem
    {
        private static EventRepository eventRepo = new EventRepository();

        public static void Main(string[] args)
        {
            bool exit = false;

            while (!exit)
            {
                Console.WriteLine("Ticket Booking System:");
                Console.WriteLine("1. Create Event");
                Console.WriteLine("2. Book Tickets");
                Console.WriteLine("3. Cancel Tickets");
                Console.WriteLine("4. Get Event Details");
                Console.WriteLine("5. Exit");
                Console.Write("Enter your choice: ");

                int choice = Convert.ToInt32(Console.ReadLine());

                switch (choice)
                {
                    case 1:
                        CreateEvent();
                        break;
                    case 2:
                        BookTickets();
                        break;
                    case 3:
                        CancelTickets();
                        break;
                    case 4:
                        GetEventDetails();
                        break;
                    case 5:
                        exit = true;
                        break;
                    default:
                        Console.WriteLine("Invalid choice. Please try again.");
                        break;
                }
            }
        }

        private static void CreateEvent()
        {
            Console.Write("Enter Event Name: ");
            string eventName = Console.ReadLine();

            Console.Write("Enter Event Date (yyyy-MM-dd): ");
            DateTime eventDate = DateTime.Parse(Console.ReadLine());

            Console.Write("Enter Event Time (HH:mm): ");
            TimeSpan eventTime = TimeSpan.Parse(Console.ReadLine());

            Console.Write("Enter Total Seats: ");
            int totalSeats = Convert.ToInt32(Console.ReadLine());

            Console.Write("Enter Ticket Price: ");
            decimal ticketPrice = Convert.ToDecimal(Console.ReadLine());

            Console.Write("Enter Event Type (Movie, Sports, Concert): ");
            string eventType = Console.ReadLine();

            Venue venue = new Venue() { VenueId = 1 };  // Assuming a valid VenueID for simplicity
            eventRepo.CreateEvent(eventName, eventDate, eventTime, totalSeats, ticketPrice, eventType, venue);
        }

        private static void BookTickets()
        {
            Console.Write("Enter Event ID: ");
            int eventID = Convert.ToInt32(Console.ReadLine());

            Console.Write("Enter Number of Tickets: ");
            int numTickets = Convert.ToInt32(Console.ReadLine());

            try
            {
                eventRepo.BookTickets(eventID, numTickets);
            }
            catch (System.Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }

        private static void CancelTickets()
        {
            Console.Write("Enter Event ID: ");
            int eventID = Convert.ToInt32(Console.ReadLine());

            Console.Write("Enter Number of Tickets to Cancel: ");
            int numTickets = Convert.ToInt32(Console.ReadLine());

            eventRepo.CancelTickets(eventID, numTickets);
        }

        private static void GetEventDetails()
        {
            Console.Write("Enter Event ID: ");
            int eventID = Convert.ToInt32(Console.ReadLine());

            Event eventObj = eventRepo.GetEventDetails(eventID);

            if (eventObj != null)
            {
                Console.WriteLine($"Event Name: {eventObj.EventName}");
                Console.WriteLine($"Event Date: {eventObj.EventDate}");
                Console.WriteLine($"Event Time: {eventObj.EventTime}");
                Console.WriteLine($"Available Seats: {eventObj.AvailableSeats}");
                Console.WriteLine($"Ticket Price: {eventObj.TicketPrice}");
            }
            else
            {
                Console.WriteLine("Event not found.");
            }
        }
    }
}
